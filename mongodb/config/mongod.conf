# ============================================================
# mongod.conf — Production MongoDB Configuration
# ============================================================

# ─── Storage ──────────────────────────────────────────────
storage:
  dbPath: /data/db
  journal:
    enabled: true
  wiredTiger:
    engineConfig:
      # Set to ~50% of available RAM per node
      # Override via --wiredTigerCacheSizeGB in command
      cacheSizeGB: 1
      journalCompressor: snappy
    collectionConfig:
      blockCompressor: snappy
    indexConfig:
      prefixCompression: true

# ─── System Log ───────────────────────────────────────────
systemLog:
  destination: file
  path: /var/log/mongodb/mongod.log
  logAppend: true
  logRotate: reopen
  verbosity: 0
  component:
    replication:
      verbosity: 1
    command:
      verbosity: 0

# ─── Process Management ───────────────────────────────────
processManagement:
  timeZoneInfo: /usr/share/zoneinfo

# ─── Network ──────────────────────────────────────────────
net:
  port: 27017
  bindIp: 0.0.0.0
  maxIncomingConnections: 1000
  compression:
    compressors: snappy,zstd,zlib

# ─── Security ─────────────────────────────────────────────
security:
  authorization: enabled
  keyFile: /etc/mongodb/keyfile/mongo-keyfile
  javascriptEnabled: false    # disable server-side JS for security

# ─── Operation Profiling ──────────────────────────────────
operationProfiling:
  slowOpThresholdMs: 100    # log queries slower than 100ms
  mode: slowOp

# ─── Replication ──────────────────────────────────────────
replication:
  replSetName: rs0
  oplogSizeMB: 2048         # 2GB oplog — increase for high-write workloads

# ─── Set Parameters ───────────────────────────────────────
setParameter:
  # Fail faster on transient network errors
  enableLocalhostAuthBypass: 0
  # Cursor timeout: 10 minutes
  cursorTimeoutMillis: 600000